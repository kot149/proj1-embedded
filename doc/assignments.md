# 組み込みシステム基礎
## 課題
### 第1週: 割り込みとPWM

- **課題1**: 仮想シリアルポートへの出力をTerminal Pluginで受信できることを確認
- **課題2**: blinkyを改造し、GPIO割り込みを使ってSW1を押すたびにLEDの色が青→赤→緑→白→青と変化するように実装
- **課題3**: buzzerを改造し、GPIO割り込みを有効にしてブザーが以下の仕様で動作するように実装
  - SW1を押すと音を出す。もう1度押すと音が消える
  - 音階は1回目「ド」、2回目「レ」、3回目「ミ」、4回目「ファ」、5回目「ソ」とし、6回目以降は1回目に戻る
- **発展課題1**: blinkyの初期LED点滅状態を保ったまま、SW1押下で色が変更されるように実装
- **発展課題2**: blinkyを改造し、内蔵LEDの色・明るさをPWMで制御するプログラムを作成

### 第2週: キャラクタ液晶ディスプレイ(LCD)

- **課題4**: LCD_SB1602.hにsetAddressLCD()とwriteTextLCD()関数を実装
- **課題5**: プロジェクトlcdを改造し、SW1を押した回数をLCDの1行目に表示するプログラムを作成
- **発展課題3**: 課題5に、SW1を1秒以上長押しでカウントをリセットする機能を追加
- **発展課題4**: SW1を押してからの経過時間を測定し、次にSW1を押すまでの時間をLCD 2行目にリアルタイム表示するストップウォッチを作成
- **発展課題5**: LCDの画面上部にアイコンを表示させる

### 第3週: カラーセンサーとロータリーエンコーダ

- **課題6**: プロジェクトcolorsensorを改造し、以下の機能を実装
  - Clear センサからの割り込みを有効化
  - カラーセンサの値をLCDに表示
- **課題7**: ラーメンタイマーの製作
  - ロータリーエンコーダで計測時間を設定
  - SW1でカウントダウン開始
  - タイマーが0になるとブザー鳴動
- **発展課題6**: 初期設定中に現在の下敷きの明るさを読み取り、自動でカラーセンサの割込み設定を行うプログラムを追加

### 第4週: 色判定器

- **課題8**: 色判定器の作成
  - ロータリーエンコーダで色選択
  - 選択した色と同じ色を検出したらブザーを鳴らす
  - 検知回数の表示
  - SW1で検知回数リセット

### 第5週: 発展課題

- **発展課題7**: 色判定器にセンサが読み取った色の通りにLEDを光らせる機能を追加
- **発展課題8**: 色判定器でブザーから任意のメロディーを演奏できるように実装
- **発展課題9**: 今回の機材で実現できることを考え、自由に実装


## 問題
### 問1
カラーLEDは3色のLEDで色を表現します．点灯のon,offだけの制
御で表現できる色は何色ありますか(但し，いずれの色も点灯していない
状態は含めない)．

2^3-1=7色

### 問2
カラーLEDをPWM制御によって，各色を2^8の段階で変化させることにすると，表現できる色は何色になりますか(但し，いずれの色も点灯していない状態は含めない)．

(2^8)^3-1=16,777,215色

### 問3
ブザーで1オクターブ高い音を鳴らすためには，周期を何倍すれば良いか答えなさい．

基準の音階の周波数f0=440×2^(n/12)とすると、1オクターブ高い音の周波数はf1=440×2^((n+1)/12)となる。
f1/f0=2なので、周波数を2倍にすれば1オクターブ高い音が鳴る。よって、周期を1/2倍すれば1オクターブ高い音が鳴る。

### 問4
割り込みの初期設定において，GPIOPadConfigSet()関数の第四引数にGPIO_PIN_TYPE_STD_WPUという値を渡しています．これは，弱いプルアップ抵抗に接続する，という意味です．なぜ割込みを受けるピンにおいてプルアップしなければならないのかを答えなさい．

ノイズによる誤動作を防ぐため。プルアップ抵抗を接続することで、ピンの電圧が安定し、ノイズによる誤動作を防ぐことができる。

何も割込みが入っていない状態ではHIGHにするため,割込みは通常
Lowレベルになることで検知するので,入カピンが不定だと誤験知するか
もしれない。

### 問5
1つのI2Cバスに接続できるI2C機器の理論的な数はアドレスの観点から見ていくつか答えなさい(但し，予約領域は省くものとする．無限に接続できるという答えは無しとする)．

I2Cの通信先の周辺機器のアドレスは7ビットなので、2^7=128通りのアドレスを表せる。
予約領域15個を引いて112個の機器に接続できる。

### 問6
my_util.cで実装されている関数がそれぞれ何をするためのものかを答えなさい．

delay_ms()関数は引数に指定した値×1msの間待機する関数。
itoh()関数はuint32_t型の数値を指定された長さの16進表記の文字列にして返す関数。
itoa() 関数は int32_t 型の数値を指定された長さの 10 進表記の文字列にして返す関数。